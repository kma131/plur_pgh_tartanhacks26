<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat - PLUR PGH</title>
  <style>body{background:#000;color:#8ACE00;font-family:'Courier New',monospace;padding:20px}.wrap{max-width:900px;margin:0 auto}.messages{height:400px;overflow:auto;border:1px solid #333;padding:10px;background:#000}</style>
</head>
<body>
  <div class="wrap">
    <h2>Community Chat</h2>
    <div class="messages" id="messages"></div>
    <div style="margin-top:8px">
      <input id="msg" style="width:80%;padding:8px;background:#000;border:1px solid #8ACE00;color:#8ACE00">
      <button id="send" style="background:#8ACE00;color:#000;padding:8px;border:none">Send</button>
    </div>
  </div>

  <script>
    async function fetchMessages(){
      try{
        const r = await fetch('/chat/messages');
        const data = await r.json();
        const el = document.getElementById('messages');
        el.innerHTML = '';
        data.forEach(m=>{
          const d = document.createElement('div');
          d.style.borderTop='1px solid #222'; d.style.padding='6px 0';
          d.innerHTML = '<strong>'+m.user+'</strong> <span style="color:#999;font-size:12px">'+new Date(m.timestamp).toLocaleString()+'</span><div>'+m.body+'</div>';
          el.appendChild(d);
        });
        el.scrollTop = el.scrollHeight;
      }catch(e){console.error(e)}
    }

    document.getElementById('send').addEventListener('click', async ()=>{
      const inp = document.getElementById('msg');
      const v = inp.value.trim();
      if(!v) return;
      try{
        await fetch('/chat/send', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message:v})});
        inp.value='';
        fetchMessages();
      }catch(e){console.error(e)}
    });

    // poll every 2s
    fetchMessages();
    setInterval(fetchMessages, 2000);
  </script>
</body>
</html>
